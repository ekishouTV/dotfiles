[tools]
bat = "latest"
dua = "latest"
eza = "latest"
fastfetch = "latest"
ghq = "latest"
node = "latest"
"npm:fx" = "latest"
starship = "latest"
usage = "latest"

[tasks.recreate-docker-volume]
run = """
    volume={{arg(name='volume')}}
    docker volume inspect $volume
    docker volume rm $volume
    docker volume create $volume
"""

[tasks.outdated-with-last-update-time]
alias = "olut"
run = '''
    lastUpdateTime=$(
        eza -l --time-style=full-iso --no-user --no-permissions ~/.local/share/mise/installs/ \
        | fx -rs "map(x => /-\s(.*\+\d{4})\s(.*)/.exec(x).slice(-2).reverse())" \
        | fx "Object.fromEntries" "{lastUpdateTime: x}"
    )
    echo $(mise outdated -J) $lastUpdateTime \
    | fx -s "Object.assign({}, ...x)" \
        "map(app => app.name !== undefined \
            ? Object.assign({}, app, {'lastUpdateTime': x['lastUpdateTime'][app.name.replace(':', '-')]}) : undefined)" \
        "filter(x => x !== undefined)" \
        "values" \
        "console.table(x, ['name', 'current', 'latest', 'lastUpdateTime'])" \
    2>/dev/null
'''
quiet = true

[settings]
idiomatic_version_file = false
